# 第11章: スケーラビリティへの対応
ビットコインの課題として以下がある
- トランザクションの取引内容が確定するまでに時間がかかる
    - 取引内容の確定に少なくとも10分、ブロックに取り込まれなければさらに10分かかる
- 処理件数が少ない
    - 1ブロックに取り込めるのは約4200トランザクション

これらの問題解決にブロックチェンーの外側で複数回分の取引を実施し、1つのトランザクションに集約した後にブロックチェーンに記録するオフチェーン技術が考えられている

## マイクロペイメントチャネル
オフチェーン技術を使用している
- 最初の取引のトランザクションをブロックに記録した後、オフチェーンで複数回取引を実施し、最後のトランザクションをブロックに記録する
    - 手数料が必要となるのは最初と最後のトランザクションのみのため少額の決済も手数料を気にせず行える

マイクロペイメントチャネルには以下の種類がある
- 単方向マイクロペイメントチャネル
- 双方向マイクロペイメントチャネル
- HTLCを利用した双方向ペイメントチャネル

### 単方向マイクロペイメントチャネル
- 2者間の取引で、片方向への支払いが可能
- 取引は単方向
- チャネルには有効期限が存在し、チャネルの有効期限が切れた場合はユーザーへ全額返金される
- Segwitが採用されない環境でも実装可能

### 双方向マイクロペイメントチャネル
- 2者間での取引で相互に支払いが可能
- チャネルの有効期限はない
- コミットメントトランザクションを二者がそれぞれ作成・保有
    - チャネルクローズ時にクロージングトランザクションを作成
    - コミットメントトランザクションは通常ブロードキャストされず相手が応答しなくなった場合にブロードキャストされる
- Segwitの仕組みが必要
    - コミットメントトランザクションを作成する際に、オープニングトランザクション署名前にオープニンゴトランザクションのアウトプットをUTXOとして参照するため
    - UTXOの参照はトランザクションIDを用いるが、署名前と後でトランザクションIDが変わらない必要がある

### Hashed Timerock Contract
決済相手に直接送金するのではなく、中間者を経由して送金するHTLCという仕組みがある  
ペイメントチャネルではチャネルをオープンする際にビットコインを2of2マルチシグ宛にデポジットするので、チャネル解説相手が増えるとロックされるビットコインが増える  
HTLCを利用することで、チャネル未開設の相手ともチャネル開設済みの第三者を経由して決済を行える  

## ライトニングネットワーク
HTLCを利用した双方向ペイメントチャネルの応用例
- ペイメントチャネルを開いている参加者をルーティングすることでネットワーク上の任意の参加者同士がペイメントチャネルを直接開いていなくても資金の授受を行うことができる

## Teechan
スケーラビリティを解決するために開発されたペイメントチャネルのプロトコル  
双方向ペイメントチャネルやライトニングネットワークと設計が似ているが、TEEsと呼ばれる実行歓呼湯を信頼店として利用している点で異なっている  
- SegregatedWitnessを利用することなく、現状の使用で双方向ペイメントチャネルを構築可能
- 取引の手順がライトニングネットワークに比べてシンプル

#### TrustedExecutionEnviroments(TEEs)
TEEsとは信頼の置けるハードウェアコンポーネント  





































