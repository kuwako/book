# 第4章: ビットコイン・ウォレット
ビットコインウォレットの主な機能
1. その人の暗号鍵の生成やバックアップやアドレス管理
1. 送金のためのトランザクションの生成
1. ブロックチェーン内にある自分に関連したトランザクション履歴
1. 自分が所持しているUTXOを簡単に把握できるようにすること

## ウォレットの初期化
### 新しいアドレスの生成
bitcoin-cli getnewaddress コマンドで新規生成できる

### アドレスにアカウントを設定できる
- アカウントの設定は必須ではない
- アカウントの設定
    - bitcoin-cli setaccount xxxxxxxxxxxxxxxxxxxxxxxxxxxx
- アカウントごとの所持金残高
    - bitcoin-cli listaccounts

### ウォレットの秘密鍵の暗号化
- bitcoin-cli encryptwallet <パスワード>

## ウォレット残高を確認する
- bitcoin-cli getbalance

### 自分宛のUTXOを確認する
- bitcoin-cli listunspent

### ビットコインを送金する
#### 取引手数料の規定値の設定
- 送金を実用的な時間で行うには手数料が必要
- BitcoinCoreでは1Kbあたりの取引手数料の規定値を設定できる
    - これを設定すると毎回送金ごとに取引手数料を設定する必要がなくなる
    - bitcoin-cli settxfee 0.00001
- bitcoin-cli sendfrom <送信アカウント名> <送信先ビットコインアドレス> <送金金額> で送信

## ビットコイン・ウォレットによる暗号鍵管理
### ウォレットのセキュリティレベルは「財布」と同じではない
- 財布であると同時に銀行口座に近い

### 送金や受領の履歴のプライバシー
- 内容は誰にでも解析可能でビットコインアドレスがわかれば、その全ての送金や受領の履歴を抜き出すことが可能

### セキュリティと利便性の両立の必要性
- 利便性を考えるとウォレットはスマホで扱える必要がある
- 一方、スマホはLTE回線やwifi、bluetoothにも繋げるため、セキュアにするのは難しい
- また紛失/盗難の可能性も大いにある

### コールドストレージとホットストレージ
2レベルセキュリティ
- 公開鍵と秘密鍵のようにセキュリティレベルのことなるデータを管理する方法

ホットストレージ  
- オンライン状態にあるマシンのストレージ
- スマホはこちら
- 少額のみの保管

コールドストレージ  
- オフライン状態にあるマシンのストレージ
- オフラインのバックアップファイルやスマートカード
- ペーパーウォレット
- 高額の保管

### ECDSAの公開鍵と秘密鍵の準同型性と決定生ウォレット
- 公開鍵と秘密鍵を独立に生成することが可能
- コールドストレージの秘密鍵にアクセスすることなくホットストレージ上の計算だけで次々に公開鍵を作成できる

### 生成した公開鍵間の関連を推定不能にする
- 送金のたびに公開鍵を使い捨てにするのは以前の送金とは無関係の別の主体として振る舞いたいから
- もし、生成した公開鍵の間の関係が推定できてしまったら、動的に暗号鍵を生成する意味がなくなる

上記を解決するには
- 実行不能なほど莫大な数にすることで解決する
- インデックスに加えて256ビットのサイズを持つ巨大な乱数を1つ追加する
- ここにハッシュ関数を適用することによって子公開鍵から親公開鍵を知ることを不可能にする

### 決定性ウォレットとルートシードによる秘密鍵のバックアップ
- 公開鍵を動的に増やすと、それに伴って秘密鍵を生成する必要があるが、リスクが伴う
- 決定性ウォレットは親秘密鍵とチェーンコードから子秘密鍵をいつでも生成し直す事ができるので鍵紛失のリスクが小さい








































